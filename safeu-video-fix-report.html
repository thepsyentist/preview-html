<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"/>
    <title>SAFE U 메인 슬라이더 비디오 — 최종 리포트</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Pretendard', -apple-system, 'Noto Sans KR', sans-serif;
            color: #212529;
            line-height: 1.65;
            background: #fff;
            font-size: 14px
        }

        .topnav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255, 255, 255, .95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #e9ecef;
            padding: 10px 16px;
            display: flex;
            gap: 6px;
            overflow-x: auto
        }

        .topnav a {
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            text-decoration: none;
            color: #495057;
            background: #f1f3f5;
            white-space: nowrap;
            transition: .2s
        }

        .topnav a:hover {
            background: #228be6;
            color: #fff
        }

        .hero {
            background: #212529;
            color: #fff;
            padding: 56px 32px;
            text-align: center
        }

        .hero h1 {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 10px
        }

        .hero p {
            font-size: 14px;
            color: #adb5bd;
            max-width: 640px;
            margin: 0 auto;
            line-height: 1.7
        }

        .hero .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin: 16px 4px 0
        }

        .badge-red {
            background: #fa5252;
            color: #fff
        }

        .badge-green {
            background: #40c057;
            color: #fff
        }

        .badge-blue {
            background: #228be6;
            color: #fff
        }

        .badge-orange {
            background: #fd7e14;
            color: #fff
        }

        .section {
            max-width: 860px;
            margin: 0 auto;
            padding: 48px 24px
        }

        .section-num {
            font-size: 11px;
            font-weight: 700;
            color: #228be6;
            letter-spacing: 1px;
            margin-bottom: 4px
        }

        .section-title {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -.5px;
            margin-bottom: 6px
        }

        .section-desc {
            font-size: 13px;
            color: #868e96;
            line-height: 1.6;
            margin-bottom: 24px
        }

        .divider {
            border: none;
            border-top: 1px solid #e9ecef;
            margin: 0
        }

        .problem-grid {
            display: grid;
            grid-template-columns:1fr 1fr;
            gap: 16px;
            margin-bottom: 20px
        }

        .problem-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef
        }

        .problem-card h4 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .problem-card p {
            font-size: 12px;
            color: #868e96;
            line-height: 1.6
        }

        .severity {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            color: #fff
        }

        .sev-high {
            background: #fa5252
        }

        .sev-mid {
            background: #fd7e14
        }

        .sev-low {
            background: #fab005
        }

        .fix-list {
            list-style: none;
            margin: 0;
            padding: 0
        }

        .fix-list li {
            padding: 16px 20px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            gap: 14px;
            align-items: flex-start
        }

        .fix-icon {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px
        }

        .fix-icon.green {
            background: #ebfbee;
            color: #40c057
        }

        .fix-list h4 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px
        }

        .fix-list p {
            font-size: 12px;
            color: #868e96;
            line-height: 1.5
        }

        code {
            background: #f1f3f5;
            padding: 1px 5px;
            border-radius: 4px;
            font-size: 12px;
            font-family: 'SF Mono', 'Fira Code', monospace
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 10px;
            padding: 16px 20px;
            font-size: 12px;
            line-height: 1.7;
            overflow-x: auto;
            font-family: 'SF Mono', 'Fira Code', monospace;
            margin: 16px 0;
            white-space: pre
        }

        .code-block .cm {
            color: #6a9955
        }

        .code-block .kw {
            color: #569cd6
        }

        .code-block .fn {
            color: #dcdcaa
        }

        .code-block .str {
            color: #ce9178
        }

        .code-block .num {
            color: #b5cea8
        }

        .timeline {
            position: relative;
            padding-left: 28px
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 4px;
            bottom: 4px;
            width: 2px;
            background: #e9ecef
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #228be6;
            background: #fff
        }

        .timeline-item.done::before {
            background: #40c057;
            border-color: #40c057
        }

        .timeline-item h4 {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 2px
        }

        .timeline-item p {
            font-size: 12px;
            color: #868e96
        }

        .files-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin: 16px 0
        }

        .files-table th {
            text-align: left;
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 700;
            font-size: 12px;
            color: #495057
        }

        .files-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef
        }

        .files-table tr:hover td {
            background: #f8f9fa
        }

        .result-grid {
            display: grid;
            grid-template-columns:1fr 1fr 1fr;
            gap: 16px
        }

        .result-card {
            text-align: center;
            padding: 24px 16px;
            border-radius: 12px;
            border: 1px solid #e9ecef
        }

        .result-card .num {
            font-size: 28px;
            font-weight: 800;
            color: #228be6;
            line-height: 1
        }

        .result-card .label {
            font-size: 12px;
            color: #868e96;
            margin-top: 6px
        }

        .result-card.success {
            border-color: #40c057;
            background: #ebfbee
        }

        .result-card.success .num {
            color: #40c057
        }

        .compare {
            display: grid;
            grid-template-columns:1fr 1fr;
            gap: 20px;
            margin: 16px 0
        }

        .compare-box {
            border-radius: 12px;
            padding: 20px;
            font-size: 13px
        }

        .compare-box.before {
            background: #fff5f5;
            border: 1px solid #ffc9c9
        }

        .compare-box.after {
            background: #ebfbee;
            border: 1px solid #b2f2bb
        }

        .compare-box h4 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px
        }

        .compare-box ul {
            padding-left: 18px;
            margin: 0
        }

        .compare-box li {
            margin-bottom: 4px;
            font-size: 12px;
            color: #495057;
            line-height: 1.5
        }

        @media (max-width: 640px) {
            .problem-grid, .compare, .result-grid {
                grid-template-columns:1fr
            }
        }
    </style>
</head>
<body>

<nav class="topnav">
    <a href="#problems">발견된 문제</a>
    <a href="#analysis">원인 분석</a>
    <a href="#solutions">해결 방법</a>
    <a href="#changes">변경 파일</a>
    <a href="#timeline">작업 타임라인</a>
    <a href="#results">최종 결과</a>
</nav>

<header class="hero">
    <h1>SAFE U 메인 슬라이더 비디오</h1>
    <p>메인 페이지 히어로 슬라이더의 배경 비디오 자동재생, 슬라이드 전환 시 초기화, 토글 버튼 제어에 대한 전체 분석 및 개선 리포트</p>
    <div>
        <span class="badge badge-red">문제 3건 발견</span>
        <span class="badge badge-green">전체 해결 완료</span>
        <span class="badge badge-blue">파일 3개 수정</span>
    </div>
</header>

<!-- 1. 발견된 문제 -->
<section class="section" id="problems">
    <div class="section-num">01</div>
    <h2 class="section-title">발견된 문제</h2>
    <p class="section-desc">Playwright 디버그 로깅 및 실제 Chrome 테스트를 통해 발견된 핵심 문제들</p>

    <div class="problem-grid">
        <div class="problem-card" style="grid-column:1/-1">
            <h4><span class="severity sev-high">심각</span> 슬라이드 전환 시 비디오가 처음부터 재생되지 않음</h4>
            <p>두 비디오 모두 HTML <code>autoplay loop</code>으로 페이지 로드 시 <strong>동시에 재생 시작</strong>. Swiper가 슬라이드를 전환해도 비활성
                비디오를 정지시키는 코드가 없어 백그라운드에서 계속 재생됨.</p>
            <div style="margin-top:12px;padding:14px 16px;background:#f8f9fa;border-radius:8px;font-size:12px;line-height:1.7;color:#495057">
                <strong>예시:</strong><br>
                ① 슬라이드 1(THINGS) 비디오 재생 중 → 슬라이드 2(WORKS)로 이동<br>
                ② THINGS 비디오는 화면에 안 보이지만 <strong>백그라운드에서 계속 재생</strong> (예: 15초 지점까지 진행)<br>
                ③ 다시 슬라이드 1로 돌아오면 → 비디오가 <strong>15초 지점부터</strong> 보임 (처음부터가 아님)<br>
                <span style="color:#868e96;margin-top:4px;display:inline-block">→ 원인: 비디오 생명주기를 Swiper 슬라이드 전환에 맞춰 관리하는 로직이 없었음</span>
            </div>
        </div>
        <div class="problem-card">
            <h4><span class="severity sev-mid">보통</span> loopFix 이벤트 충돌 (수정 중 발견)</h4>
            <p>비디오 관리 로직 추가 후 발생. Swiper <code>loop:true</code> + 2슬라이드 구조에서 <code>loopFix</code>가 slideChange를 추가 발생시켜
                방금 재생된 비디오를 즉시 정지</p>
        </div>
        <div class="problem-card">
            <h4><span class="severity sev-low">경미</span> UI 색상 전환 지연</h4>
            <p>THINGS↔WORKS 전환 시 컨트롤바 색상(흰색↔검정)이 <code>slideChangeTransitionEnd</code>에서 처리되어 ~1초 지연</p>
        </div>
    </div>
</section>

<hr class="divider">

<!-- 2. 원인 분석 -->
<section class="section" id="analysis">
    <div class="section-num">02</div>
    <h2 class="section-title">원인 분석</h2>
    <p class="section-desc">Playwright에 디버그 인터셉터를 주입하여 play()/pause() 호출 타이밍을 밀리초 단위로 추적한 결과</p>

    <h3 style="font-size:15px;font-weight:700;margin-bottom:12px">핵심 레이스 컨디션 (디버그 로그)</h3>
    <div class="code-block">
        <span class="cm">// Swiper 초기화 시점 (INTRO_DELAY = 2100ms 후)</span>
        [<span class="num">2114ms</span>] slideChangeTransitionEnd → syncVideo
        → pause(): things, works
        → play(): things <span class="cm">// ← 성공!</span>

        [<span class="num">2129ms</span>] play() <span class="str">SUCCESS</span>: things (paused=false)

        [<span class="num">2140ms</span>] <span class="kw">loopFix</span> → slideChange (or 2nd TransitionEnd)
        → pause(): things <span class="cm">// ← 방금 재생된 비디오를 즉시 정지!</span>
        → pause(): works
        → play() 시도 → activeSlide 못찾음 → <span class="str">재생 실패</span>

        <span class="cm">// 결과: 비디오가 첫 프레임에서 멈춤</span>
    </div>

    <div class="compare">
        <div class="compare-box before">
            <h4>문제 원인 요약</h4>
            <ul>
                <li><code>slideChangeTransitionEnd</code>가 init 중 연속 발생</li>
                <li>첫 번째 호출: 재생 성공</li>
                <li>26ms 후 두 번째 호출: 모두 정지 → 재생 대상 못찾음</li>
                <li><code>slideChange</code>에서 pause-all 로직이 loopFix 이벤트에도 실행</li>
                <li>토글 버튼은 <code>swiper.autoplay</code>만 제어, 비디오 미제어</li>
            </ul>
        </div>
        <div class="compare-box after">
            <h4>해결 전략</h4>
            <ul>
                <li><code>debouncedSync</code>: 60ms 디바운스로 연속 호출 중 마지막만 실행</li>
                <li><code>slideChange</code>에서 비디오 조작 완전 제거</li>
                <li>Swiper 생성 직후 명시적 <code>debouncedSync(swiper)</code> 호출</li>
                <li>토글 버튼에 비디오 pause/play 직접 제어 추가</li>
                <li>재생 시 <code>video.play()</code>만 호출 (currentTime 리셋 없음)</li>
            </ul>
        </div>
    </div>
</section>

<hr class="divider">

<!-- 3. 해결 방법 -->
<section class="section" id="solutions">
    <div class="section-num">03</div>
    <h2 class="section-title">해결 방법</h2>
    <p class="section-desc">각 문제에 대한 구체적인 해결 방법과 적용된 코드</p>

    <ul class="fix-list">
        <li>
            <div class="fix-icon green">1</div>
            <div>
                <h4>syncVideo — 비디오 생명주기 관리 함수 추가</h4>
                <p>슬라이드 전환 시 <strong>모든 비디오 정지 + currentTime=0 리셋</strong> 후, 활성 슬라이드 비디오만 0초부터 재생. 비활성 비디오의 백그라운드 재생과
                    중간부터 재생되는 문제를 한번에 해결</p>
            </div>
        </li>
        <li>
            <div class="fix-icon green">2</div>
            <div>
                <h4>디바운스로 loopFix 이벤트 충돌 방지</h4>
                <p>Swiper <code>loopFix</code>가 이벤트를 연속 발생시켜도 <code>debouncedSync</code>(60ms)로 마지막 1회만 실행. play→pause
                    충돌 방지</p>
            </div>
        </li>
        <li>
            <div class="fix-icon green">3</div>
            <div>
                <h4>slideChange는 UI 전용, 비디오 조작 분리</h4>
                <p><code>slideChange</code>는 UI 색상 전환만 담당 (즉시 반영). 비디오 제어는 <code>slideChangeTransitionEnd</code>에서만 처리하여
                    loopFix 충돌 방지</p>
            </div>
        </li>
    </ul>

    <h3 style="font-size:15px;font-weight:700;margin:24px 0 12px">최종 코드 구조</h3>
    <div class="code-block">
        <span class="kw">let</span> userPaused = <span class="kw">false</span>;
        <span class="kw">let</span> syncTimer = <span class="kw">null</span>;

        <span class="kw">function</span> <span class="fn">syncVideo</span>(sw) {
        <span class="cm">// 1) 모든 비디오 정지 + 0초 리셋</span>
        sw.slides.<span class="fn">forEach</span>(slide =&gt; {
        <span class="kw">const</span> v = slide.<span class="fn">querySelector</span>(<span class="str">"video"</span>);
        <span class="kw">if</span> (v) { v.<span class="fn">pause</span>(); v.currentTime = <span class="num">0</span>;
        }
        });

        <span class="kw">if</span> (userPaused) <span class="kw">return</span>; <span
            class="cm">// 사용자 일시정지 시 재생 안함</span>

        <span class="cm">// 2) 활성 슬라이드 비디오만 재생</span>
        <span class="kw">const</span> video = sw.slides[sw.activeIndex]?.<span class="fn">querySelector</span>(<span
            class="str">"video"</span>);
        <span class="kw">if</span> (!video) <span class="kw">return</span>;
        video.muted = <span class="kw">true</span>;
        video.loop = <span class="kw">true</span>;
        video.<span class="fn">play</span>();
        }

        <span class="kw">function</span> <span class="fn">debouncedSync</span>(sw) {
        <span class="fn">clearTimeout</span>(syncTimer);
        syncTimer = <span class="fn">setTimeout</span>(() =&gt; <span class="fn">syncVideo</span>(sw), <span
            class="num">60</span>);
        }

        <span class="cm">// Swiper 이벤트:</span>
        <span class="fn">slideChange</span>() → UI 색상만 전환
        <span class="fn">slideChangeTransitionEnd</span>() → <span class="fn">debouncedSync</span>(this)

        <span class="cm">// 초기화 직후:</span>
        <span class="fn">debouncedSync</span>(swiper); <span class="cm">// ← 확실한 첫 재생 보장</span>
    </div>
</section>

<hr class="divider">

<!-- 4. 변경 파일 -->
<section class="section" id="changes">
    <div class="section-num">04</div>
    <h2 class="section-title">변경 파일</h2>
    <p class="section-desc">수정된 파일 목록과 각 파일의 변경 내용</p>

    <table class="files-table">
        <thead>
        <tr>
            <th>파일</th>
            <th>변경 내용</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><code>index.html</code></td>
            <td>
                <code>&lt;video autoplay muted loop playsinline&gt;</code><br>
                → <code>&lt;video muted loop playsinline preload="auto"&gt;</code><br>
                <span style="font-size:12px;color:#868e96">autoplay 제거, preload="auto" 추가 (2개 비디오 태그)</span>
            </td>
        </tr>
        <tr>
            <td><code>en/index.html</code></td>
            <td>
                index.html과 동일한 변경 적용 (영문 버전)
            </td>
        </tr>
        <tr>
            <td><code>resources/js/main.js</code></td>
            <td>
                Swiper 비디오 제어 로직 전면 개선<br>
                <span style="font-size:12px;color:#868e96">
            • <code>debouncedSync</code> 추가 (60ms 디바운스)<br>
            • <code>slideChange</code>에서 pause-all 제거<br>
            • <code>userPaused</code> 플래그 + 토글 버튼 비디오 제어<br>
            • 토글 재생 시 이어서 재생 (currentTime 리셋 없음)<br>
            • Swiper 생성 직후 <code>debouncedSync(swiper)</code> 호출
          </span>
            </td>
        </tr>
        </tbody>
    </table>
</section>

<hr class="divider">

<!-- 5. 타임라인 -->
<section class="section" id="timeline">
    <div class="section-num">05</div>
    <h2 class="section-title">작업 타임라인</h2>
    <p class="section-desc">문제 발견부터 해결까지의 과정</p>

    <div class="timeline">
        <div class="timeline-item done">
            <h4>문제 발견 — 슬라이드 전환 시 비디오 미초기화</h4>
            <p>비활성 슬라이드의 비디오가 백그라운드에서 계속 재생. 돌아올 때 중간부터 보이는 현상 확인</p>
        </div>
        <div class="timeline-item done">
            <h4>syncVideo 함수 구현</h4>
            <p>슬라이드 전환 시 모든 비디오 정지 + currentTime=0 리셋 후 활성 비디오만 재생하는 생명주기 관리 추가</p>
        </div>
        <div class="timeline-item done">
            <h4>loopFix 레이스 컨디션 발견 — Playwright 디버깅</h4>
            <p>play()/pause() 인터셉터 주입으로 loopFix가 26ms 후 비디오를 즉시 정지시키는 것 확인</p>
        </div>
        <div class="timeline-item done">
            <h4>debouncedSync 도입으로 이벤트 충돌 해결</h4>
            <p>60ms 디바운스로 연속 이벤트 중 마지막 1회만 실행. slideChange는 UI 색상 전환 전용으로 분리</p>
        </div>
    </div>
</section>

<hr class="divider">

<!-- 6. 결과 -->
<section class="section" id="results">
    <div class="section-num">06</div>
    <h2 class="section-title">최종 결과</h2>
    <p class="section-desc">Playwright 자동 테스트 + 실제 Chrome 브라우저 테스트 결과</p>

    <div class="result-grid">
        <div class="result-card success">
            <div class="num">3/3</div>
            <div class="label">문제 해결</div>
        </div>
        <div class="result-card success">
            <div class="num">3</div>
            <div class="label">수정 파일</div>
        </div>
        <div class="result-card success">
            <div class="num">60ms</div>
            <div class="label">디바운스 간격</div>
        </div>
    </div>

    <div class="compare" style="margin-top:24px">
        <div class="compare-box before">
            <h4>수정 전</h4>
            <ul>
                <li>슬라이드 전환 시 비디오가 중간부터 재생</li>
                <li>비활성 비디오가 백그라운드에서 계속 재생 (리소스 낭비)</li>
                <li>색상 전환이 ~1초 지연</li>
            </ul>
        </div>
        <div class="compare-box after">
            <h4>수정 후</h4>
            <ul>
                <li>슬라이드 전환 시 비디오가 항상 0초부터 시작</li>
                <li>비활성 비디오 즉시 정지 + 리셋</li>
                <li>색상 전환 즉시 반영</li>
            </ul>
        </div>
    </div>
</section>

<div style="text-align:center;padding:40px 24px;color:#adb5bd;font-size:12px">
    Generated with Claude Code — 2025.02.13
</div>

</body>
</html>